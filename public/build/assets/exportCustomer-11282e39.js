import{_ as E,L as z,a as x,c as D,w as N,r as y,o as i,b as P,d as e,g as f,j as v,h as a,l as g,F as p,t as l,i as V,n as b,k as F}from"../js/app2.js";import{P as T}from"./page-header-48f5a59e.js";import{L as B}from"./loader-7b01d283.js";import{E as M,h as O}from"./jspdf.es.min-99e08454.js";const j={components:{Layout:z,PageHeader:T,Loader:B},data(){return{title:"صفحه خروجی گرفتن از اطلاعات مشتری",items:[{text:"مشتری",href:"/"},{text:"خروجی پی دی اف",active:!0}],isLoading:!1,notFound:!1,searchQuery:"",transactionslist:[],filter_rasid_bord:"",typeOfExchange:"",orderModel:"",currencyModel:"",SelectedDakhl:"",banks:[],currencies:[],customerName:"",currentPage:1,totalPages:1,limit:10,customerbalances:[],isFiltering:!1}},mounted(){this.getTransactionbycid(),this.filter_rasid_bord="all",this.typeOfExchange="all"},methods:{async getTransactionbycid(n=1){var s,_,h,o,c;try{this.isLoading=!0;const d=await x.post("/customerinfo",{id:this.$route.params.id,rasid_bord:this.rasid_bord,order_id:this.order_id,bank_acount_id:this.bank_acount_id});this.transactionslist=(s=d.data.transactions)==null?void 0:s.data,this.orderslist=(_=d.data)==null?void 0:_.orders,this.rasid=d.data.rasid,this.bord=d.data.bord,this.totalAmount=d.data.total_amount,this.totalPages=(h=d.data.customers)==null?void 0:h.last_page(),this.currentPage=n,this.customerbalances=d.data.customerBalance,this.customerName=(c=(o=d.data)==null?void 0:o.customer)==null?void 0:c.data[0].name,this.currencies=d.data.currencies}catch(d){console.log(d.message)}finally{this.isLoading=!1}},change_currency(){this.getBanks(this.currencyModel)},async getBanks(n){try{const s=await x.get("/getbankbyid/"+n);this.banks=s.data.banks,this.SelectedDakhl=this.banks[0].id}catch(s){console.log(s.message)}},async filterCustomerExport(){try{this.isFiltering=!0;const n=await x.post("/exportcustomertopdf",{id:this.$route.params.id,transaction_type:this.typeOfExchange,rasid_bord:this.filter_rasid_bord,currency:this.currencyModel});this.transactionslist=n.data.customerExportFilter.data}catch(n){console.log(n.message)}finally{this.isFiltering=!1}},exportToPDF(){try{const n=[this.$refs.table1,this.$refs.table2],s=new M("p","mm","a4"),_=190,h="../../../../fonts/arial.ttf";s.addFileToVFS("arial.ttf",h),s.setFont("arial"),s.setFontSize(12);let o=20;n.forEach((c,d)=>{O(c).then(u=>{const k=u.toDataURL("image/png"),m=u.height*_/u.width;if(s.addImage(k,"PNG",10,o,_,m),o+=m+10,d===n.length-1){const t=s.internal.getNumberOfPages();for(let r=1;r<=t;r++){s.setPage(r);const C=`Page ${r} of ${t}`,L=12,w=s.internal.pageSize.getWidth()/2,S=s.internal.pageSize.getHeight()-10;s.setFontSize(L),s.text(C,w,S,{align:"center"})}s.save(`${this.customerName}.pdf`)}})})}catch(n){console.log(n.message)}}}},q={class:"row"},H={class:"col-12"},U={class:"card"},W={class:"card-body"},A=e("h4",{class:"card-title mb-4"},"جستجوی معامله",-1),G={class:"repeater",enctype:"multipart/form-data"},I={class:"row"},Q={class:"mb-3 col-md-2"},R=e("label",{for:"email"},"نوع معامله",-1),X=e("option",{value:"all",selected:""},"همه",-1),Y=e("option",{value:"rasid"},"رسید",-1),J=e("option",{value:"bord"},"برد",-1),K=e("option",{value:"bord"},"سفارش",-1),Z=[X,Y,J,K],$={class:"mb-3 col-md-2"},ee=e("label",{for:"email"},"نوع رسید وبرد",-1),te=e("option",{value:"all"},"همه",-1),se=e("option",{value:"rasid"},"رسید",-1),oe=e("option",{value:"bord"},"برد",-1),le=[te,se,oe],ie={class:"col-md-2 col-xs-12"},ae=e("label",{for:"supplier"},"واحد پول :",-1),ne=e("option",{disabled:"",selected:""}," واحد",-1),de=["value"],re=e("span",{class:"text-danger error-text currency_error"},null,-1),ce={class:"col-md-2 col-xs-12"},_e=e("label",{for:"supplier"},"انتخاب دخل : ",-1),he=e("option",{disabled:"",selected:""},"ابتدا واحد پول را انتخاب کنید.",-1),ue=["value"],me=e("span",{class:"text-danger error-text dakhl_error"},null,-1),ge={class:"col-lg-1 align-self-center"},pe={class:"d-grid"},be=["disabled"],fe={class:"col-xl-12"},ve={class:"card",style:{"min-height":"100vh"}},ke={class:"card-body"},xe={class:"text-center"},ye={class:"col-xl-12 col-lg-12"},Pe={class:"card"},Fe={class:"row"},Ce=e("div",{class:"col-md-10"},null,-1),Le={class:"col-md-2"},we={class:"me-2 mb-2 d-inline-block"},Se={class:"position-relative"},Ee={class:"row justify-content-center"},ze={class:"col-xl-12"},De=e("hr",{class:"mb-4"},null,-1),Ne={key:0},Ve={key:1,class:""},Te={key:0,class:"table-responsive"},Be={key:0,class:"text-center font-size-20"},Me={key:1,class:"table table-centered table-nowrap",ref:"table2"},Oe=e("thead",null,[e("tr",null,[e("th",{class:"text-center"},"نمبر چک"),e("th",{class:"text-center"},"رسید برد"),e("th",{class:"text-center"},"مقدار پول"),e("th",{class:"text-center"},"پول"),e("th",{class:"text-center"},"تفصیلات"),e("th",{class:"text-center"},"توسط")])],-1),je={key:0},qe={key:1},He={key:0},Ue={key:1},We=e("hr",null,null,-1),Ae=e("tr",null,[e("th",null,"واحد"),e("th",null,"کل رسید "),e("th",{colspan:"2"},"کل برداشتها"),e("th",{colspan:"2"},"بیلانس")],-1),Ge={colspan:"2"},Ie={colspan:"2"},Qe={class:"pagination pagination-rounded justify-content-center mb-2",style:{}},Re={class:"page-item"},Xe=["disabled"],Ye=e("i",{class:"mdi mdi-chevron-left"},null,-1),Je=[Ye],Ke={class:"page-link",href:"javascript: void(0);"},Ze={class:"page-item"},$e=["disabled"],et=e("i",{class:"mdi mdi-chevron-right"},null,-1),tt=[et];function st(n,s,_,h,o,c){const d=y("PageHeader"),u=y("Loader"),k=y("Layout");return i(),D(k,null,{default:N(()=>{var m;return[P(d,{title:o.title,items:o.items},null,8,["title","items"]),e("div",q,[e("div",H,[e("div",U,[e("div",W,[A,e("form",G,[e("div",null,[e("div",I,[e("div",Q,[R,f(e("select",{class:"form-control form-control-lg required","onUpdate:modelValue":s[0]||(s[0]=t=>o.typeOfExchange=t)},Z,512),[[v,o.typeOfExchange]])]),e("div",$,[ee,f(e("select",{class:"form-control form-control-lg required","onUpdate:modelValue":s[1]||(s[1]=t=>o.filter_rasid_bord=t)},le,512),[[v,o.filter_rasid_bord]])]),e("div",ie,[ae,f(e("select",{class:"form-control form-control-lg select2 required",onChange:s[2]||(s[2]=(...t)=>c.change_currency&&c.change_currency(...t)),"onUpdate:modelValue":s[3]||(s[3]=t=>o.currencyModel=t)},[ne,(i(!0),a(p,null,g(o.currencies,t=>(i(),a("option",{key:t==null?void 0:t.id,value:t==null?void 0:t.id},l(t==null?void 0:t.name)+" "+l(t==null?void 0:t.sign),9,de))),128))],544),[[v,o.currencyModel]]),re]),e("div",ce,[_e,f(e("select",{class:"form-control form-control-lg select2 required","onUpdate:modelValue":s[4]||(s[4]=t=>o.SelectedDakhl=t)},[he,(i(!0),a(p,null,g(o.banks,t=>(i(),a("option",{key:t.id,value:t.id},l(t.account_name),9,ue))),128))],512),[[v,o.SelectedDakhl]]),me]),e("div",ge,[e("div",pe,[e("input",{type:"button",class:"btn btn-primary btn-block",value:"جستجو",disabled:n.isSearching,onClick:s[5]||(s[5]=(...t)=>c.filterCustomerExport&&c.filterCustomerExport(...t))},null,8,be)])])])])])])])]),e("div",fe,[e("div",ve,[e("div",ke,[e("div",xe,[e("div",ye,[e("div",Pe,[e("div",Fe,[Ce,e("div",Le,[e("div",we,[e("div",Se,[e("button",{class:"btn btn-primary",onClick:s[6]||(s[6]=(...t)=>c.exportToPDF&&c.exportToPDF(...t))},"خروجی گرفتن")])])])]),e("div",null,[e("div",Ee,[e("div",ze,[e("div",null,[De,e("h3",{ref:"table1"}," لیست تمامی تراکنش های "+l(o.customerName),513),o.isLoading?(i(),a("div",Ne,[P(u)])):(i(),a("div",Ve,[(m=o.transactionslist)!=null&&m.length?(i(),a("div",Te,[o.notFound?(i(),a("div",Be," نتیجه مورد نظر یافت نشد! ")):(i(),a("table",Me,[Oe,e("tbody",null,[(i(!0),a(p,null,g(o.transactionslist,t=>{var r;return i(),a("tr",{key:t==null?void 0:t.id},[e("td",null,l(t.check_number),1),e("td",null,[e("span",{class:b(["badge font-size-12",t.rasid_bord==="rasid"?"bg-success":"bg-danger"])},l(t.rasid_bord),3)]),e("td",null,[F(l(t.amount)+" "+l(t.tr_currency.name)+" "+l(t.rasid_bord==="rasid"?"به":"از")+" ",1),t.bank_account!=null?(i(),a("span",je,l(t.bank_account.account_name),1)):(i(),a("span",qe,l(t.finance_account.account_name),1))]),e("td",null,[F(l(t.amount_equal)+" "+l((r=t==null?void 0:t.eq_currency)==null?void 0:r.name)+" "+l(t.rasid_bord==="rasid"?"به":"از")+" ",1),t.bank_account!=null?(i(),a("span",He,l(t.bank_account.account_name),1)):(i(),a("span",Ue,l(t.finance_account.account_name),1))]),e("td",null,l(t.desc),1),e("td",null,l(t.user_id),1)])}),128))]),We,Ae,e("tbody",null,[(i(!0),a(p,null,g(o.customerbalances,(t,r)=>(i(),a("tr",{key:r},[e("td",null,l(r),1),e("td",null,[e("span",{class:b(["badge font-size-13",t.rasid>0?"bg-success":"bg-danger"])},l(t.rasid),3)]),e("td",Ge,[e("span",{class:b(["badge font-size-13",t.bord>0?"bg-success":"bg-danger"])},l(t.bord),3)]),e("td",Ie,[e("span",{class:b(["badge font-size-13",t.balance>0?"bg-success":"bg-danger"])},l(t.balance),3)])]))),128))])],512)),e("ul",Qe,[e("li",Re,[e("a",{class:"page-link",href:"javascript: void(0);","aria-label":"Previous",onClick:s[7]||(s[7]=(...t)=>n.prevPage&&n.prevPage(...t)),disabled:o.currentPage===1},Je,8,Xe)]),(i(!0),a(p,null,g(o.totalPages,(t,r)=>(i(),a("li",{class:b(["page-item",{active:t===o.currentPage}]),key:r},[e("a",Ke,l(t),1)],2))),128)),e("li",Ze,[e("a",{class:"page-link",href:"javascript: void(0);","aria-label":"Next",onClick:s[8]||(s[8]=(...t)=>n.nextPage&&n.nextPage(...t)),disabled:o.currentPage===o.totalPages},tt,8,$e)])])])):V("",!0)]))])])])])])])])])])])])]}),_:1})}const nt=E(j,[["render",st]]);export{nt as default};
